{"ast":null,"code":"\"use strict\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar assign = require('object-assign');\n\nvar _require = require('../util/observable'),\n    map = _require.map,\n    filter = _require.filter;\n\nvar validators = require('../validators');\n\nvar getSelection = require('../util/getSelection');\n\nvar encodeQueryString = require('./encodeQueryString');\n\nvar Transaction = require('./transaction');\n\nvar Patch = require('./patch');\n\nvar listen = require('./listen');\n\nvar excludeFalsey = function excludeFalsey(param, defValue) {\n  var value = typeof param === 'undefined' ? defValue : param;\n  return param === false ? undefined : value;\n};\n\nvar getMutationQuery = function getMutationQuery() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return _objectSpread({\n    returnIds: true,\n    returnDocuments: excludeFalsey(options.returnDocuments, true),\n    visibility: options.visibility || 'sync'\n  }, options.skipCrossDatasetReferenceValidation && {\n    skipCrossDatasetReferenceValidation: options.skipCrossDatasetReferenceValidation\n  });\n};\n\nvar isResponse = function isResponse(event) {\n  return event.type === 'response';\n};\n\nvar getBody = function getBody(event) {\n  return event.body;\n};\n\nvar indexBy = function indexBy(docs, attr) {\n  return docs.reduce(function (indexed, doc) {\n    indexed[attr(doc)] = doc;\n    return indexed;\n  }, Object.create(null));\n};\n\nvar toPromise = function toPromise(observable) {\n  return observable.toPromise();\n};\n\nvar getQuerySizeLimit = 11264;\nmodule.exports = {\n  listen: listen,\n  getDataUrl: function getDataUrl(operation, path) {\n    var config = this.clientConfig;\n    var catalog = validators.hasDataset(config);\n    var baseUri = \"/\".concat(operation, \"/\").concat(catalog);\n    var uri = path ? \"\".concat(baseUri, \"/\").concat(path) : baseUri;\n    return \"/data\".concat(uri).replace(/\\/($|\\?)/, '$1');\n  },\n  fetch: function fetch(query, params) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var mapResponse = options.filterResponse === false ? function (res) {\n      return res;\n    } : function (res) {\n      return res.result;\n    };\n\n    var observable = this._dataRequest('query', {\n      query: query,\n      params: params\n    }, options).pipe(map(mapResponse));\n\n    return this.isPromiseAPI() ? toPromise(observable) : observable;\n  },\n  getDocument: function getDocument(id) {\n    var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var options = {\n      uri: this.getDataUrl('doc', id),\n      json: true,\n      tag: opts.tag\n    };\n\n    var observable = this._requestObservable(options).pipe(filter(isResponse), map(function (event) {\n      return event.body.documents && event.body.documents[0];\n    }));\n\n    return this.isPromiseAPI() ? toPromise(observable) : observable;\n  },\n  getDocuments: function getDocuments(ids) {\n    var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var options = {\n      uri: this.getDataUrl('doc', ids.join(',')),\n      json: true,\n      tag: opts.tag\n    };\n\n    var observable = this._requestObservable(options).pipe(filter(isResponse), map(function (event) {\n      var indexed = indexBy(event.body.documents || [], function (doc) {\n        return doc._id;\n      });\n      return ids.map(function (id) {\n        return indexed[id] || null;\n      });\n    }));\n\n    return this.isPromiseAPI() ? toPromise(observable) : observable;\n  },\n  create: function create(doc, options) {\n    return this._create(doc, 'create', options);\n  },\n  createIfNotExists: function createIfNotExists(doc, options) {\n    validators.requireDocumentId('createIfNotExists', doc);\n    return this._create(doc, 'createIfNotExists', options);\n  },\n  createOrReplace: function createOrReplace(doc, options) {\n    validators.requireDocumentId('createOrReplace', doc);\n    return this._create(doc, 'createOrReplace', options);\n  },\n  patch: function patch(selector, operations) {\n    return new Patch(selector, operations, this);\n  },\n  delete: function _delete(selection, options) {\n    return this.dataRequest('mutate', {\n      mutations: [{\n        delete: getSelection(selection)\n      }]\n    }, options);\n  },\n  mutate: function mutate(mutations, options) {\n    var mut = mutations instanceof Patch || mutations instanceof Transaction ? mutations.serialize() : mutations;\n    var muts = Array.isArray(mut) ? mut : [mut];\n    var transactionId = options && options.transactionId;\n    return this.dataRequest('mutate', {\n      mutations: muts,\n      transactionId: transactionId\n    }, options);\n  },\n  transaction: function transaction(operations) {\n    return new Transaction(operations, this);\n  },\n  dataRequest: function dataRequest(endpoint, body) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    var request = this._dataRequest(endpoint, body, options);\n\n    return this.isPromiseAPI() ? toPromise(request) : request;\n  },\n  _dataRequest: function _dataRequest(endpoint, body) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var isMutation = endpoint === 'mutate';\n    var isQuery = endpoint === 'query'; // Check if the query string is within a configured threshold,\n    // in which case we can use GET. Otherwise, use POST.\n\n    var strQuery = !isMutation && encodeQueryString(body);\n    var useGet = !isMutation && strQuery.length < getQuerySizeLimit;\n    var stringQuery = useGet ? strQuery : '';\n    var returnFirst = options.returnFirst;\n    var timeout = options.timeout,\n        token = options.token,\n        tag = options.tag,\n        headers = options.headers;\n    var uri = this.getDataUrl(endpoint, stringQuery);\n    var reqOptions = {\n      method: useGet ? 'GET' : 'POST',\n      uri: uri,\n      json: true,\n      body: useGet ? undefined : body,\n      query: isMutation && getMutationQuery(options),\n      timeout: timeout,\n      headers: headers,\n      token: token,\n      tag: tag,\n      canUseCdn: isQuery\n    };\n    return this._requestObservable(reqOptions).pipe(filter(isResponse), map(getBody), map(function (res) {\n      if (!isMutation) {\n        return res;\n      } // Should we return documents?\n\n\n      var results = res.results || [];\n\n      if (options.returnDocuments) {\n        return returnFirst ? results[0] && results[0].document : results.map(function (mut) {\n          return mut.document;\n        });\n      } // Return a reduced subset\n\n\n      var key = returnFirst ? 'documentId' : 'documentIds';\n      var ids = returnFirst ? results[0] && results[0].id : results.map(function (mut) {\n        return mut.id;\n      });\n      return _defineProperty({\n        transactionId: res.transactionId,\n        results: results\n      }, key, ids);\n    }));\n  },\n  _create: function _create(doc, op) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    var mutation = _defineProperty({}, op, doc);\n\n    var opts = assign({\n      returnFirst: true,\n      returnDocuments: true\n    }, options);\n    return this.dataRequest('mutate', {\n      mutations: [mutation]\n    }, opts);\n  }\n};","map":{"version":3,"sources":["C:/Users/joaki/Documents/GitHub/Utvikling-Av-Interaktive-Nettsteder/Oppgave 8 React Sanity/react/node_modules/@sanity/client/lib/data/dataMethods.js"],"names":["ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","value","configurable","writable","assign","require","_require","map","validators","getSelection","encodeQueryString","Transaction","Patch","listen","excludeFalsey","param","defValue","undefined","getMutationQuery","options","returnIds","returnDocuments","visibility","skipCrossDatasetReferenceValidation","isResponse","event","type","getBody","body","indexBy","docs","attr","reduce","indexed","doc","create","toPromise","observable","getQuerySizeLimit","module","exports","getDataUrl","operation","path","config","clientConfig","catalog","hasDataset","baseUri","concat","uri","replace","fetch","query","params","mapResponse","filterResponse","res","result","_dataRequest","pipe","isPromiseAPI","getDocument","id","opts","json","tag","_requestObservable","documents","getDocuments","ids","join","_id","_create","createIfNotExists","requireDocumentId","createOrReplace","patch","selector","operations","delete","_delete","selection","dataRequest","mutations","mutate","mut","serialize","muts","Array","isArray","transactionId","transaction","endpoint","request","isMutation","isQuery","strQuery","useGet","stringQuery","returnFirst","timeout","token","headers","reqOptions","method","canUseCdn","results","document","op","mutation"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\r\n\r\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\r\n\r\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\r\n\r\nvar assign = require('object-assign');\r\n\r\nvar _require = require('../util/observable'),\r\n    map = _require.map,\r\n    filter = _require.filter;\r\n\r\nvar validators = require('../validators');\r\n\r\nvar getSelection = require('../util/getSelection');\r\n\r\nvar encodeQueryString = require('./encodeQueryString');\r\n\r\nvar Transaction = require('./transaction');\r\n\r\nvar Patch = require('./patch');\r\n\r\nvar listen = require('./listen');\r\n\r\nvar excludeFalsey = function excludeFalsey(param, defValue) {\r\n  var value = typeof param === 'undefined' ? defValue : param;\r\n  return param === false ? undefined : value;\r\n};\r\n\r\nvar getMutationQuery = function getMutationQuery() {\r\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\r\n  return _objectSpread({\r\n    returnIds: true,\r\n    returnDocuments: excludeFalsey(options.returnDocuments, true),\r\n    visibility: options.visibility || 'sync'\r\n  }, options.skipCrossDatasetReferenceValidation && {\r\n    skipCrossDatasetReferenceValidation: options.skipCrossDatasetReferenceValidation\r\n  });\r\n};\r\n\r\nvar isResponse = function isResponse(event) {\r\n  return event.type === 'response';\r\n};\r\n\r\nvar getBody = function getBody(event) {\r\n  return event.body;\r\n};\r\n\r\nvar indexBy = function indexBy(docs, attr) {\r\n  return docs.reduce(function (indexed, doc) {\r\n    indexed[attr(doc)] = doc;\r\n    return indexed;\r\n  }, Object.create(null));\r\n};\r\n\r\nvar toPromise = function toPromise(observable) {\r\n  return observable.toPromise();\r\n};\r\n\r\nvar getQuerySizeLimit = 11264;\r\nmodule.exports = {\r\n  listen: listen,\r\n  getDataUrl: function getDataUrl(operation, path) {\r\n    var config = this.clientConfig;\r\n    var catalog = validators.hasDataset(config);\r\n    var baseUri = \"/\".concat(operation, \"/\").concat(catalog);\r\n    var uri = path ? \"\".concat(baseUri, \"/\").concat(path) : baseUri;\r\n    return \"/data\".concat(uri).replace(/\\/($|\\?)/, '$1');\r\n  },\r\n  fetch: function fetch(query, params) {\r\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\r\n    var mapResponse = options.filterResponse === false ? function (res) {\r\n      return res;\r\n    } : function (res) {\r\n      return res.result;\r\n    };\r\n\r\n    var observable = this._dataRequest('query', {\r\n      query: query,\r\n      params: params\r\n    }, options).pipe(map(mapResponse));\r\n\r\n    return this.isPromiseAPI() ? toPromise(observable) : observable;\r\n  },\r\n  getDocument: function getDocument(id) {\r\n    var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\r\n    var options = {\r\n      uri: this.getDataUrl('doc', id),\r\n      json: true,\r\n      tag: opts.tag\r\n    };\r\n\r\n    var observable = this._requestObservable(options).pipe(filter(isResponse), map(function (event) {\r\n      return event.body.documents && event.body.documents[0];\r\n    }));\r\n\r\n    return this.isPromiseAPI() ? toPromise(observable) : observable;\r\n  },\r\n  getDocuments: function getDocuments(ids) {\r\n    var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\r\n    var options = {\r\n      uri: this.getDataUrl('doc', ids.join(',')),\r\n      json: true,\r\n      tag: opts.tag\r\n    };\r\n\r\n    var observable = this._requestObservable(options).pipe(filter(isResponse), map(function (event) {\r\n      var indexed = indexBy(event.body.documents || [], function (doc) {\r\n        return doc._id;\r\n      });\r\n      return ids.map(function (id) {\r\n        return indexed[id] || null;\r\n      });\r\n    }));\r\n\r\n    return this.isPromiseAPI() ? toPromise(observable) : observable;\r\n  },\r\n  create: function create(doc, options) {\r\n    return this._create(doc, 'create', options);\r\n  },\r\n  createIfNotExists: function createIfNotExists(doc, options) {\r\n    validators.requireDocumentId('createIfNotExists', doc);\r\n    return this._create(doc, 'createIfNotExists', options);\r\n  },\r\n  createOrReplace: function createOrReplace(doc, options) {\r\n    validators.requireDocumentId('createOrReplace', doc);\r\n    return this._create(doc, 'createOrReplace', options);\r\n  },\r\n  patch: function patch(selector, operations) {\r\n    return new Patch(selector, operations, this);\r\n  },\r\n  delete: function _delete(selection, options) {\r\n    return this.dataRequest('mutate', {\r\n      mutations: [{\r\n        delete: getSelection(selection)\r\n      }]\r\n    }, options);\r\n  },\r\n  mutate: function mutate(mutations, options) {\r\n    var mut = mutations instanceof Patch || mutations instanceof Transaction ? mutations.serialize() : mutations;\r\n    var muts = Array.isArray(mut) ? mut : [mut];\r\n    var transactionId = options && options.transactionId;\r\n    return this.dataRequest('mutate', {\r\n      mutations: muts,\r\n      transactionId: transactionId\r\n    }, options);\r\n  },\r\n  transaction: function transaction(operations) {\r\n    return new Transaction(operations, this);\r\n  },\r\n  dataRequest: function dataRequest(endpoint, body) {\r\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\r\n\r\n    var request = this._dataRequest(endpoint, body, options);\r\n\r\n    return this.isPromiseAPI() ? toPromise(request) : request;\r\n  },\r\n  _dataRequest: function _dataRequest(endpoint, body) {\r\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\r\n    var isMutation = endpoint === 'mutate';\r\n    var isQuery = endpoint === 'query'; // Check if the query string is within a configured threshold,\r\n    // in which case we can use GET. Otherwise, use POST.\r\n\r\n    var strQuery = !isMutation && encodeQueryString(body);\r\n    var useGet = !isMutation && strQuery.length < getQuerySizeLimit;\r\n    var stringQuery = useGet ? strQuery : '';\r\n    var returnFirst = options.returnFirst;\r\n    var timeout = options.timeout,\r\n        token = options.token,\r\n        tag = options.tag,\r\n        headers = options.headers;\r\n    var uri = this.getDataUrl(endpoint, stringQuery);\r\n    var reqOptions = {\r\n      method: useGet ? 'GET' : 'POST',\r\n      uri: uri,\r\n      json: true,\r\n      body: useGet ? undefined : body,\r\n      query: isMutation && getMutationQuery(options),\r\n      timeout: timeout,\r\n      headers: headers,\r\n      token: token,\r\n      tag: tag,\r\n      canUseCdn: isQuery\r\n    };\r\n    return this._requestObservable(reqOptions).pipe(filter(isResponse), map(getBody), map(function (res) {\r\n      if (!isMutation) {\r\n        return res;\r\n      } // Should we return documents?\r\n\r\n\r\n      var results = res.results || [];\r\n\r\n      if (options.returnDocuments) {\r\n        return returnFirst ? results[0] && results[0].document : results.map(function (mut) {\r\n          return mut.document;\r\n        });\r\n      } // Return a reduced subset\r\n\r\n\r\n      var key = returnFirst ? 'documentId' : 'documentIds';\r\n      var ids = returnFirst ? results[0] && results[0].id : results.map(function (mut) {\r\n        return mut.id;\r\n      });\r\n      return _defineProperty({\r\n        transactionId: res.transactionId,\r\n        results: results\r\n      }, key, ids);\r\n    }));\r\n  },\r\n  _create: function _create(doc, op) {\r\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\r\n\r\n    var mutation = _defineProperty({}, op, doc);\r\n\r\n    var opts = assign({\r\n      returnFirst: true,\r\n      returnDocuments: true\r\n    }, options);\r\n    return this.dataRequest('mutate', {\r\n      mutations: [mutation]\r\n    }, opts);\r\n  }\r\n};"]},"metadata":{},"sourceType":"script"}